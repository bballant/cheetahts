<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soccer Field</title>
    <style>
        /* Apply the monospace font to the entire body */
        body {
            font-family: monospace;
            font-size: 1.2em;
        }
        tbody {
            padding: 0;
        }
        table td, table td * {
            vertical-align: top;
        }
        ul {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }
        ul#SubNames {
            margin-top: 0px;
            margin-bottom: 10px;
        }
        ul#SubNames li {
            display: inline;
        }
        ul#SubNames li + li::before {
            content: ", ";
        }
        h4 {
            margin: 0px 0 5px 0;
            padding-top: 0px;
        }
    </style>
</head>

<body>
    <h2 id="MainTitle"></h2>
    <table id="NavTable">
        <tbody>
            <tr>
                <td>
                    <table id="PeriodLinksTable">
                        <tbody></tbody>
                    </table>
                </td>
                <td><canvas id="SoccerCanvas" width="360" height="270"></canvas></td>
            </tr>
            <tr>
                <td>&lt;-&gt;</td>
                <td id="SubActions"></div></td>
            </tr>
            <tr>
                <td>Subs</td>
                <td id="Subs"></div></td>
            </tr>
        </tbody>
    </table>
    
    <br/>
    <table id="playerPositionsTable">
        <tbody></tbody>
    </table>
    <div id="Nav"></div>
    <div>&nbsp;</div>
    <div><input type="text" size="8">&nbsp;<button id="AddPlayerButton">Add Player</button></div>
    <div>&nbsp;</div>
    <div><span id="RemovePlayerSpan"></span>&nbsp;<button id="AddPlayerButton">Remove Player</button></div>
    <div>&nbsp;</div>
    <a href="/index.html?time=6.5&formation=322&timePeriods=%255B%257B%2522time%2522%253A0%252C%2522subs%2522%253A%255B%2522Margay%2522%252C%2522Caracal%2522%255D%252C%2522GK%2522%253A%2522Bobcat%2522%252C%2522LB%2522%253A%2522Leopard%2522%252C%2522CB%2522%253A%2522Jaguar%2522%252C%2522RB%2522%253A%2522Puma%2522%252C%2522LM%2522%253A%2522Tiger%2522%252C%2522RM%2522%253A%2522Lynx%2522%252C%2522LF%2522%253A%2522Lion%2522%252C%2522RF%2522%253A%2522Ocelot%2522%257D%252C%257B%2522time%2522%253A6.5%252C%2522subs%2522%253A%255B%2522Lion%2522%252C%2522Leopard%2522%255D%252C%2522GK%2522%253A%2522Bobcat%2522%252C%2522LB%2522%253A%2522Caracal%2522%252C%2522CB%2522%253A%2522Jaguar%2522%252C%2522RB%2522%253A%2522Puma%2522%252C%2522LM%2522%253A%2522Tiger%2522%252C%2522RM%2522%253A%2522Lynx%2522%252C%2522LF%2522%253A%2522Margay%2522%252C%2522RF%2522%253A%2522Ocelot%2522%257D%252C%257B%2522time%2522%253A13%252C%2522subs%2522%253A%255B%2522Puma%2522%252C%2522Tiger%2522%255D%252C%2522GK%2522%253A%2522Bobcat%2522%252C%2522LB%2522%253A%2522Caracal%2522%252C%2522CB%2522%253A%2522Jaguar%2522%252C%2522RB%2522%253A%2522Leopard%2522%252C%2522LM%2522%253A%2522Lion%2522%252C%2522RM%2522%253A%2522Lynx%2522%252C%2522LF%2522%253A%2522Margay%2522%252C%2522RF%2522%253A%2522Ocelot%2522%257D%252C%257B%2522time%2522%253A19.5%252C%2522subs%2522%253A%255B%2522Jaguar%2522%252C%2522Ocelot%2522%255D%252C%2522GK%2522%253A%2522Bobcat%2522%252C%2522LB%2522%253A%2522Caracal%2522%252C%2522CB%2522%253A%2522Puma%2522%252C%2522RB%2522%253A%2522Leopard%2522%252C%2522LM%2522%253A%2522Lion%2522%252C%2522RM%2522%253A%2522Lynx%2522%252C%2522LF%2522%253A%2522Margay%2522%252C%2522RF%2522%253A%2522Tiger%2522%257D%252C%257B%2522time%2522%253A26%252C%2522subs%2522%253A%255B%2522Lynx%2522%252C%2522Caracal%2522%255D%252C%2522GK%2522%253A%2522Tiger%2522%252C%2522LB%2522%253A%2522Ocelot%2522%252C%2522CB%2522%253A%2522Margay%2522%252C%2522RB%2522%253A%2522Lion%2522%252C%2522LM%2522%253A%2522Bobcat%2522%252C%2522RM%2522%253A%2522Leopard%2522%252C%2522LF%2522%253A%2522Puma%2522%252C%2522RF%2522%253A%2522Jaguar%2522%257D%252C%257B%2522time%2522%253A32.5%252C%2522subs%2522%253A%255B%2522Puma%2522%252C%2522Margay%2522%255D%252C%2522GK%2522%253A%2522Tiger%2522%252C%2522LB%2522%253A%2522Ocelot%2522%252C%2522CB%2522%253A%2522Lynx%2522%252C%2522RB%2522%253A%2522Lion%2522%252C%2522LM%2522%253A%2522Bobcat%2522%252C%2522RM%2522%253A%2522Leopard%2522%252C%2522LF%2522%253A%2522Caracal%2522%252C%2522RF%2522%253A%2522Jaguar%2522%257D%252C%257B%2522time%2522%253A39%252C%2522subs%2522%253A%255B%2522Jaguar%2522%252C%2522Ocelot%2522%255D%252C%2522GK%2522%253A%2522Tiger%2522%252C%2522LB%2522%253A%2522Margay%2522%252C%2522CB%2522%253A%2522Lynx%2522%252C%2522RB%2522%253A%2522Lion%2522%252C%2522LM%2522%253A%2522Bobcat%2522%252C%2522RM%2522%253A%2522Leopard%2522%252C%2522LF%2522%253A%2522Caracal%2522%252C%2522RF%2522%253A%2522Puma%2522%257D%252C%257B%2522time%2522%253A45.5%252C%2522subs%2522%253A%255B%2522Lion%2522%252C%2522Leopard%2522%255D%252C%2522GK%2522%253A%2522Tiger%2522%252C%2522LB%2522%253A%2522Margay%2522%252C%2522CB%2522%253A%2522Lynx%2522%252C%2522RB%2522%253A%2522Ocelot%2522%252C%2522LM%2522%253A%2522Bobcat%2522%252C%2522RM%2522%253A%2522Jaguar%2522%252C%2522LF%2522%253A%2522Caracal%2522%252C%2522RF%2522%253A%2522Puma%2522%257D%255D&name=Wildcats+Vs+Ravens">test</a>
    <div>&nbsp;</div>
    <script src="out/soccer.js"></script>
    <script src="out/ui.js"></script>
    <script>
        /* Setup and querystring parsing */

        const canvas = document.getElementById('SoccerCanvas');
        const game = parseUrl();

        console.log(game);

        document.title = "Game: " + game.name;
        document.getElementById('MainTitle').innerHTML = document.title;

        var positionKeys = getPositionKeys(game);

        // print to console some useful stuff that I will find a better way
        console.log(game.timePeriods);
        console.log(createCSV(positionKeys, game.timePeriods));
        // calculate minsPerPeriod
        // gross but I don't feel like threading the duration in
        // this makes sure we don't error out if we load w/ no data
        let minsPerPeriod = 6.5;
        if (game.timePeriods.length > 1) {
            minsPerPeriod = game.timePeriods[1].time - game.timePeriods[0].time;
        }
        const minutesPlayed = calculateMinutesPlayed(minsPerPeriod, positionKeys, game.timePeriods);

        const currentPeriod = getCurrentPeriod(game);

        const players = new Map();
        const positions = new Map();
        positionKeys.forEach((positionKey) => {
            const player = currentPeriod[positionKey];
            if (player) {
                players.set(positionKey, player);
                positions.set(player, positionKey);
            }
        });
        const subs = currentPeriod.subs ? currentPeriod.subs : [];

        // Combine the "subs" list with the players from the "players" map
        const playersList = [...subs, ...Array.from(players.values())];
        const playersSet = new Set(playersList);
        const allPlayers = Array.from(playersSet);

        /* Draw the field */
        drawSoccerField(canvas, 2, 2, 358, 268, game.formation, players);

        /* Time period links */
        const periodLinks = document.getElementById('PeriodLinksTable').getElementsByTagName('tbody')[0];
        drawTimePeriodLinks(periodLinks, game, positionKeys);

        /* Information table below */
        const tableBody = document.getElementById('playerPositionsTable').getElementsByTagName('tbody')[0];
        totalRows = Math.max(game.timePeriods.length, positionKeys.length + currentPeriod.subs.length);

        // create the rows for the table
        for (var r = 0; r < totalRows; r++) {
            const row = tableBody.insertRow();
        }

        /* Position player selectors */
        drawSelectors(tableBody, allPlayers, positionKeys, players,
            mkSelectorDropdownHandler(game, allPlayers, currentPeriod));

        /* Player info */
        const leCell = tableBody.rows[0].insertCell(2)
        leCell.rowSpan = positionKeys.length;
        leCell.vAlign = "top";
        allPlayers.sort();
        drawPlayerInfo(leCell, allPlayers, positions, minutesPlayed);

        /* Sub info just below field */
        drawSubInfo(document.getElementById('Subs'), document.getElementById('SubActions'), game, positionKeys);

        /* Player Remove UI */
        const removePlayerSpan = document.getElementById("RemovePlayerSpan");
        removePlayerSpan.appendChild(mkRemovePlayerSelect(allPlayers));

    </script>
</body>

</html>

